<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Advanced Tool - xFearyZer</title>
  <style>
    /* (r√∫t g·ªçn style cho demo; b·∫°n gi·ªØ nguy√™n style trong file g·ªëc n·∫øu mu·ªën) */
    body { background:#0a0a12;color:#e0e0e0;font-family: "Segoe UI", Tahoma, sans-serif; }
    .container{max-width:1100px;margin:40px auto;padding:20px;text-align:center;}
    .slide{display:inline-block;width:320px;height:220px;background:rgba(30,30,50,0.8);border-radius:12px;padding:20px;cursor:pointer;margin:10px;}
    .slide h3{margin:10px 0;}
    /* popup */
    .popup-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;visibility:hidden;opacity:0;transition:opacity .2s;}
    .popup-overlay.active{visibility:visible;opacity:1;}
    .popup{background:#12121b;padding:22px;border-radius:12px;max-width:420px;width:92%;color:#dcdff0;}
    .btn{padding:10px 16px;border-radius:8px;border:none;cursor:pointer;}
    .btn-primary{background:linear-gradient(90deg,#6a5acd,#9370db);color:#fff;}
    .btn-ghost{background:rgba(255,255,255,0.06);color:#dcdff0;border:1px solid rgba(255,255,255,0.04);}
    .countdown{font-weight:700;color:#ffd36b;margin-top:8px;}
  </style>
</head>
<body>
  <div class="container">
    <h1>Advanced Tool</h1>
    <p>Nh·∫•n v√†o m·ª•c Key Tool ƒë·ªÉ l·∫•y quy·ªÅn truy c·∫≠p (token m·∫∑c ƒë·ªãnh 20 ph√∫t).</p>

    <div class="slide" id="keyToolSlide" onclick="openKeyToolPopup()">
      <div class="icon">üîë</div>
      <h3>Key Tool</h3>
      <p>Key generation and rejoin system</p>
    </div>
  </div>

  <!-- Popup th√¥ng b√°o & countdown -->
  <div class="popup-overlay" id="keyPopup">
    <div class="popup">
      <h2>V∆∞·ª£t link sang Key Tool</h2>
      <p>N·∫øu b·∫°n ti·∫øp t·ª•c, h·ªá th·ªëng s·∫Ω t·∫°o m·ªôt token t·∫°m th·ªùi c√≥ hi·ªáu l·ª±c <span id="durationLabel">20 ph√∫t</span>. Token n√†y s·∫Ω ƒë∆∞·ª£c g·∫Øn v√†o URL v√† cho ph√©p truy c·∫≠p v√†o trang Key Tool.</p>
      <div style="margin:10px 0;">
        <div>Th·ªùi gian c√≤n l·∫°i ƒë·ªÉ chuy·ªÉn: <span class="countdown" id="popupCountdown">--:--</span></div>
      </div>
      <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:14px;">
        <button class="btn btn-ghost" onclick="closeKeyToolPopup()">H·ªßy</button>
        <button class="btn btn-primary" id="continueBtn" onclick="continueToKeyTool()">Ti·∫øp t·ª•c</button>
      </div>
    </div>
  </div>

<script>
/*
  GitHub Page script:
  - Hi·ªán popup khi b·∫•m Key Tool slide.
  - T·∫°o token ng·∫´u nhi√™n + expiry (m·∫∑c ƒë·ªãnh 20 ph√∫t).
  - N·∫øu countdown h·∫øt tr∆∞·ªõc khi b·∫•m "Ti·∫øp t·ª•c", t·ª± reset token (t·∫°o token m·ªõi) v√† countdown l·∫°i.
  - Khi b·∫•m "Ti·∫øp t·ª•c", redirect sang Netlify: https://xfearyzer-keysystem.netlify.app?token=...&exp=...
*/

// ====== C·∫•u h√¨nh (c√≥ th·ªÉ ch·ªânh) ======
const TOKEN_DURATION_MS = 20 * 60 * 1000; // m·∫∑c ƒë·ªãnh 20 ph√∫t (ch·ªânh n·∫øu mu·ªën)

// ====== Bi·∫øn n·ªôi b·ªô ======
let popup = document.getElementById('keyPopup');
let popupCountdown = document.getElementById('popupCountdown');
let durationLabel = document.getElementById('durationLabel');
let continueBtn = document.getElementById('continueBtn');

let tokenData = { token: null, exp: 0 };
let countdownInterval = null;

// Hi·ªÉn th·ªã popup
function openKeyToolPopup() {
  // t·∫°o token ban ƒë·∫ßu
  generateToken();
  popup.classList.add('active');
}

// ƒë√≥ng popup
function closeKeyToolPopup() {
  popup.classList.remove('active');
  stopCountdown();
}

// t·∫°o token v√† b·∫Øt ƒë·∫ßu countdown
function generateToken() {
  tokenData.token = Math.random().toString(36).substr(2, 12);
  tokenData.exp = Date.now() + TOKEN_DURATION_MS;
  updateCountdown(); // c·∫≠p nh·∫≠t hi·ªÉn th·ªã
  startCountdown();
}

// chuy·ªÉn ƒë·∫øn Netlify k√®m token & exp
function continueToKeyTool() {
  // build url
  const url = new URL('https://xfearyzer-keysystem.netlify.app');
  url.searchParams.set('token', tokenData.token);
  url.searchParams.set('exp', tokenData.exp.toString());
  // chuy·ªÉn h∆∞·ªõng
  window.location.href = url.toString();
}

// countdown hi·ªÉn th·ªã
function updateCountdown() {
  const rem = tokenData.exp - Date.now();
  if (rem <= 0) {
    popupCountdown.textContent = "00:00";
    // n·∫øu h·∫øt h·∫°n tr∆∞·ªõc khi chuy·ªÉn, t·∫°o token m·ªõi t·ª± ƒë·ªông v√† ti·∫øp t·ª•c countdown
    generateToken();
    return;
  }
  const mm = Math.floor(rem / 60000);
  const ss = Math.floor((rem % 60000) / 1000);
  popupCountdown.textContent = `${String(mm).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;
  durationLabel.textContent = `${Math.floor(TOKEN_DURATION_MS/60000)} ph√∫t`;
}

// start/stop
function startCountdown() {
  stopCountdown();
  countdownInterval = setInterval(updateCountdown, 1000);
}
function stopCountdown() {
  if (countdownInterval) { clearInterval(countdownInterval); countdownInterval = null; }
}

// khi ng∆∞·ªùi d√πng ƒë√≥ng tab ho·∫∑c chuy·ªÉn ƒëi, d·ª´ng interval
window.addEventListener('beforeunload', () => stopCountdown());
</script>
</body>
</html>