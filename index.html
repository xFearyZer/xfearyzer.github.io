<!DOCTYPE html>
<html>
<head>
  <title>Get Your Key</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>
<body>
  <button id="getKeyBtn">Get Key</button>
  <div id="keyDisplay"></div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDNx8GwL7Cy81tkRsgtePuSRuUTc6UzyTo",
      authDomain: "key-management-system-xfaz.firebaseapp.com",
      projectId: "key-management-system-xfaz",
      storageBucket: "key-management-system-xfaz.firebasestorage.app",
      messagingSenderId: "399959977089",
      appId: "1:399959977089:web:c6375723189aea23087180"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    document.getElementById('getKeyBtn').addEventListener('click', async () => {
      try {
        // Generate random key
        const newKey = generateKey();
        
        // Add to Firestore
        await db.collection('keys').add({
          key: newKey,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          used: false,
          usedAt: null,
          usedBy: null
        });
        
        // Display to user
        document.getElementById('keyDisplay').textContent = `Your Key: ${newKey}`;
      } catch (error) {
        console.error("Error generating key: ", error);
      }
    });

    function generateKey() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
      let result = '';
      for (let i = 0; i < 5; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      result += '-';
      for (let i = 0; i < 5; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      result += '-';
      for (let i = 0; i < 5; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return result;
    }
  </script>
</body>
</html>
