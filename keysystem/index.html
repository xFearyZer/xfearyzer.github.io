<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Tool Key</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1>Your Tool Key</h1>
        <div id="keyDisplay"></div>
        <button id="renewKeyBtn">Generate New Key</button>
    </div>

    <script>
        // ================= PHẦN KIỂM TRA BẢO MẬT =================
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('vt');
        const sessionId = urlParams.get('session');
        const timestamp = urlParams.get('ts');

        // Kiểm tra nếu có tham số bảo mật
        if (token && sessionId && timestamp) {
            if (token !== localStorage.getItem('yt_verify_token') || 
                sessionId !== sessionStorage.getItem('yeumoney_session') ||
                (Date.now() - parseInt(timestamp)) > 300000) {
                
                clearAllData();
                window.location.href = "https://xfearyzer.github.io?error=invalid_access";
                return;
            }
            // Xóa token sau khi xác minh
            localStorage.removeItem('yt_verify_token');
        }

        function clearAllData() {
            localStorage.removeItem('yt_verify_token');
            localStorage.removeItem('robloxKey');
            localStorage.removeItem('awaitingVerification');
            sessionStorage.removeItem('yeumoney_session');
        }
        // ============== HẾT PHẦN KIỂM TRA BẢO MẬT ==============

        // Hàm tạo key ngẫu nhiên
        function generateKey() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let key = '';
            for (let i = 0; i < 10; i++) {
                key += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return `ROBLOX-${key}`;
        }

        // Xử lý khi trang load
        document.addEventListener('DOMContentLoaded', function() {
            const keyDisplay = document.getElementById('keyDisplay');
            const renewBtn = document.getElementById('renewKeyBtn');
            
            // Kiểm tra key hiện có
            const savedKey = localStorage.getItem('robloxKey');
            const expiry = localStorage.getItem('keyExpiry');
                
            if (savedKey && expiry && new Date().getTime() < expiry) {
                displayKey(savedKey, new Date(parseInt(expiry)));
            } else {
                // Nếu không có key hợp lệ, tạo key mới ngay lập tức
                createNewKey();
            }
            
            // Xử lý nút renew - tạo key mới ngay mà không qua Yeumoney
            renewBtn.addEventListener('click', function() {
                createNewKey();
            });
        });

        // Hàm tạo key mới
        function createNewKey() {
            const newKey = generateKey();
            const expiryDate = new Date();
            expiryDate.setDate(expiryDate.getDate() + 7); // 7 ngày
            
            localStorage.setItem('robloxKey', newKey);
            localStorage.setItem('keyExpiry', expiryDate.getTime());
            
            displayKey(newKey, expiryDate);
        }
        
        // Hàm hiển thị key
        function displayKey(key, expiryDate) {
            const daysLeft = Math.ceil((expiryDate - new Date()) / (1000 * 60 * 60 * 24));
            
            document.getElementById('keyDisplay').innerHTML = `
                <div class="key-value">${key}</div>
                <div class="expiry-info">
                    Expires: ${expiryDate.toLocaleDateString()}
                    <br>(${daysLeft} days remaining)
                </div>
                <button id="copyKeyBtn">
                    <i class="far fa-copy"></i> Copy Key
                </button>
            `;
            
            document.getElementById('copyKeyBtn').addEventListener('click', function() {
                navigator.clipboard.writeText(key);
                alert('Key copied to clipboard!');
            });
        }
    </script>
</body>
</html>
